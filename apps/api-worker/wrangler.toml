name = "rag-bookmarks-api"
main = "src/index.ts"
compatibility_date = "2024-03-01"
compatibility_flags = ["nodejs_compat"]

[vars]
ENVIRONMENT = "development"

# Queue bindings
[[queues.producers]]
queue = "bookmark-ingestion"
binding = "INGESTION_QUEUE"

[[queues.consumers]]
queue = "bookmark-ingestion"
max_batch_size = 10       # Increased from 1 to 10 for parallel processing
max_batch_timeout = 5     # Wait up to 5 seconds to batch

[[queues.producers]]
queue = "entity-extraction"
binding = "ENTITY_QUEUE"

[[queues.consumers]]
queue = "entity-extraction"
max_batch_size = 5
max_batch_timeout = 10

# Secrets (set via wrangler secret put):
# - DATABASE_URL
# - OPENROUTER_API_KEY  (LLM for summaries)
# - JINA_API_KEY        (embeddings + reranking)
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET
# - JWT_SECRET
# - TMDB_API_KEY        (movie/TV enrichment)
